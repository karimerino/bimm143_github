---
title: "Class 10 Halloween Mini Project"
author: "Carolina Merino ( PID: 14484883 )"
format: pdf
toc: TRUE
---

As it is nearly Halloween and the half way point in the quarter let's do a mini project to help us out the best candy!


## 1. Importing candy data


Our data comes from the 538 website and is available as a CSV file:

```{r}
Candy_file <- read.csv("candy-data.csv")
candy <- read.csv("candy-data.csv", row.names = 1)
head(candy)

```

>> Q1: How many different candy types are in this dataset?

There are a total of **85 candy types** included in this dataset.

```{r}
nrow(candy)
```
> Q2: How many fruity candy types are in the dataset?

There are **38 fruity candy types.**

```{r}
sum(candy[,2])
```
## 2. What is your favorite candy?

The winpercent variable shows how often a candy wins when compared to another at random, with higher values meaning greater popularity. We can find Twix’s winpercent by using its name as the row label in the dataset.


> Q3. What is your favorite candy in the dataset and what is it’s winpercent value?

For my favorite candy in the dataset is **Baby Ruth, and its winpercent value is 56.91%.**

```{r}
candy["Baby Ruth", ]$winpercent
```

> Q4. What is the winpercent value for “Kit Kat”?

The winpercent value for Kit Kat is **76.77%.**

```{r}
candy["Kit Kat", ]$winpercent
```
> Q5. What is the winpercent value for “Tootsie Roll Snack Bars”?

The winpercent value for Tootsie Roll Snack Bars is **49.65%.**
```{r}
candy["Tootsie Roll Snack Bars", ]$winpercent
```


For Another way to pull winpercent using dplyr package:

```{r}
library(dplyr)


candy|>
  filter(rownames(candy)=="Boston Baked Beans") |> 
  select(winpercent)
```

*let's install skimr package in console to use following code


```{r}
skimr::skim(candy)
```


> Q6. Is there any variable/column that looks to be on a different scale to the majority of the other columns in the dataset?

The `winpercent` column appears to be on a different scale compared to most of the other columns.



> Q7. What do you think a zero and one represent for the candy$chocolate column?

For the chocolate column, 0 signifies the candy lacks chocolate (FALSE) and 1 signifies it contains chocolate (TRUE).

* let's load tidyyverse for the next section

```{r}
library(tidyverse)
library(ggplot2)
```
> Q8. Plot a histogram of winpercent values

Creating a histogram of the winpercent values

```{r}
ggplot(candy) +
  aes(winpercent) +
  geom_histogram(bins=20, color="black", fill="lightblue")

```

> Q9. Is the distribution of winpercent values symmetrical?

The graph shows that the distribution of winpercent value is **not* **symmetrical.

```{r}
ggplot(candy) +
  aes(winpercent) +
  geom_density()
```

> Q10. Is the center of the distribution above or below 50%?

On average, the winpercent values fall below 50%, around 47.83%.

```{r}
mean(candy$winpercent)
summary(candy$winpercent)
```
> Q11. On average is chocolate candy higher or lower ranked than fruit candy?

The chocolates are ranked higher on average than fruity candies (60.92% vs. 44.12%).

```{r}
mean(candy$winpercent[as.logical(candy$chocolate)])
mean(candy$winpercent[as.logical(candy$fruity)])


mean(candy$winpercent[as.logical(candy$chocolate)]) > mean(candy$winpercent[as.logical(candy$fruity)])
```
> Q12. Is this difference statistically significant?

With a p-value of 2.871e-08, which falls below 0.05, we can conclude that the difference is statistically significant.

```{r}
t.test(candy$winpercent[as.logical(candy$chocolate)], candy$winpercent[as.logical(candy$fruity)])
```

## 3. Overall Candy Rankings

We can sort the entire dataset by winpercent using base R’s `order()` and `head()` functions. Alternatively, the `arrange()` function from the tidyverse’s dplyr package achieves the same result.


> Q13. What are the five least liked candy types in this set?

The candies with the lowest winpercent are Nik L Nip, Boston Baked Beans, Chiclets, Super Bubble, and Jawbusters.


```{r}
head(candy[order(candy$winpercent),], n=5)
```


> Q14. What are the top 5 all time favorite candy types out of this set?

The five most popular candies in the dataset are **Snickers, Kit Kat, Twix, Reese's Miniatures, and Reese's Peanut Butter Cup.**

```{r}
tail(candy[order(candy$winpercent),], n=5)
```

> Q15. Make a first barplot of candy ranking based on winpercent values.

Creating the Bar Plot..

```{r}
ggplot(candy) + 
  aes(winpercent, rownames(candy)) +
  geom_col()
```

> Q16. This is quite ugly, use the reorder() function to get the bars sorted by winpercent?

Making a better bar plot:

```{r}
ggplot(candy) + 
  aes(winpercent, reorder(rownames(candy),winpercent)) +
  geom_col()
```

**Now, let's go ahead and add some color to out plot:

```{r}
my_cols=rep("black", nrow(candy))
my_cols[as.logical(candy$chocolate)] = "chocolate"
my_cols[as.logical(candy$bar)] = "brown"
my_cols[as.logical(candy$fruity)] = "pink"


ggplot(candy) + 
  aes(winpercent, reorder(rownames(candy),winpercent)) +
  geom_col(fill=my_cols) 
```

> Q17. What is the worst ranked chocolate candy?

Among the chocolate candies, *Sixlets ranks the lowest.*

> Q18. What is the best ranked fruity candy?

*Starburst* holds the highest ranking among the fruit-flavored candies.

## 4. Taking a look at pricepercent

To evaluate value for money, we can plot winpercent against pricepercent, which ranks candy prices relative to the dataset. Since many labels may overlap, we can use `geom_text_repel()` from the ggrepel package to make the candy names readable.


```{r}
library(ggrepel)


# How about a plot of price vs win
ggplot(candy) +
  aes(winpercent, pricepercent, label=rownames(candy)) +
  geom_point(col=my_cols) + 
  geom_text_repel(col=my_cols, size=3.3, max.overlaps = 5)
```

> Q19. Which candy type is the highest ranked in terms of winpercent for the least money - i.e. offers the most bang for your buck?

*Reese's Miniatures* offers the most bang for your buck.


> Q20. What are the top 5 most expensive candy types in the dataset and of these which is the least popular?

The priciest five candies are *Nik L Nip, Nestle Smarties, Ring Pop, Hershey's Krackel, and Hershey's Milk Chocolate, with Nik L Nip* being the least liked among them.

```{r}
ord <- order(candy$pricepercent, decreasing = TRUE)
head( candy[ord,c(11,12)], n=5 )
```

OPTIONAL:


> Q21. Make a barplot again with geom_col() this time using pricepercent and then improve this step by step, first ordering the x-axis by value and finally making a so called “dot chat” or “lollipop” chart by swapping geom_col() for geom_point() + geom_segment().


```{r}
ggplot(candy) +
  aes(pricepercent, reorder(rownames(candy), pricepercent)) +
  geom_col()
```


```{r}
ggplot(candy) +
  aes(pricepercent, reorder(rownames(candy), pricepercent)) +
  geom_segment(aes(yend = reorder(rownames(candy), pricepercent), 
                   xend = 0), col="gray40") +
    geom_point()
```


## 5. Exploring the correlation structure

Next, we’ll examine how the variables relate using a correlation matrix visualized with the corrplot package.


```{r}
library(corrplot)


cij <- cor(candy)
corrplot(cij)
```


> Q22. Examining this plot what two variables are anti-correlated (i.e. have minus values)?

*Fruit and chocolate* are the two variables showing the strongest anti-correlation.

> Q23. Similarly, what two variables are most positively correlated?

The two variables that are most positively correlated are chocolate and winpercent and  chocolate and bar.



## 6. Principal Component Analysis

We perform PCA on the candy dataset using the `prcomp()` function, making sure to set `scale=TRUE`.

For the main PCA result firgure:

```{r}
pca <- prcomp(candy, scale=TRUE)

```

```{r}
str(candy)

```

```{r}
numeric_candy <- candy[, sapply(candy, is.numeric)]
pca <- prcomp(numeric_candy, scale=TRUE)

```

```{r}
my_data <- cbind(candy, pca$x[,1:3])
p <- ggplot(my_data) + 
        aes(x=PC1, y=PC2, 
            size=winpercent/100,  
            text=rownames(my_data),
            label=rownames(my_data)) +
        geom_point(col=my_cols)


p
```

```{r}
library(ggrepel)


p + geom_text_repel(size=3.3, col=my_cols, max.overlaps = 7)  + 
  theme(legend.position = "none") +
  labs(title="Halloween Candy PCA Space",
       subtitle="Colored by type: chocolate bar (dark brown), chocolate other (light brown), fruity (red), other (black)",
       caption="Data from 538")
```
* Let's install 'plotly' package 

```{r, eval = knitr::is_html_output()}
library(plotly)
ggplotly(p)
```

It’s also important to check the “loadings” to see how the original variables influence the principal components.

```{r}
par(mar=c(8,4,2,2))
barplot(pca$rotation[,1], las=2, ylab="PC1 Contribution")
```


> Q24. What original variables are picked up strongly by PC1 in the positive direction? Do these make sense to you?

PC1 highlights the original variables fruity, hard, and pluribus in the positive direction. This aligns with expectations, as these variables tend to be correlated for example, Skittles demonstrate all three traits.
